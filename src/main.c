/*================================================================================================*/
/*
 * main.c
 *
 *  Created on: 13.10.2016
 *      Author: grzegorz
 */
/*================================================================================================*/
#include "g2systemInit.h"
#include "g2systemLog.h"
#include "g2OsThread.h"
/*================================================================================================*/
void initialize(void) {
	info("Configuring LEDs.");
	RCC->AHBENR |= RCC_AHBENR_GPIOCEN;
	GPIOC->MODER &= ~(3 << (8 << 1)) | (3 << (9 << 1));
	GPIOC->MODER |= (1 << (8 << 1)) | (1 << (9 << 1));
	GPIOC->ODR = 0;
	info("System ready to work.");
}
/*================================================================================================*/
void toggleLed(int number) {
	number &= 0xF;
	GPIOC->ODR ^= (1 << number);
}
/*================================================================================================*/
void thread1(void* param) {
	(void) param;
	if (param) {
		info((const char*) param);
	} else {
		info("I'm in thread no. 1.");
	}
	for (;;) {
		toggleLed(8);
		delayMs(500);
	}
}
;
/*================================================================================================*/
void thread2(void* param) {
	(void) param;
	info("I'm in thead no. 2.");
	for (;;) {
		toggleLed(9);
		delayMs(250);
	}
}
/*================================================================================================*/
int main(void) {
	initialize();
	registerThread(thread1, "W1", "Welcome from thread no. 1!");
	registerThread(thread2, "W2", NULL);
	runOS();
	return 0;
}
/*================================================================================================*/
/*                                              EOF                                               */
/*================================================================================================*/
